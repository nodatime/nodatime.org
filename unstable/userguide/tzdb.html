

<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />
	<title>Updating the time zone database</title>

	<!-- foundation default -->
  	<link rel="stylesheet" href="../../css/foundation.css" />

    <!-- Foundicons -->
    <link rel="stylesheet" href="../../css/general_enclosed_foundicons.css">

	<script src="../../js/vendor/custom.modernizr.js"></script>

    <link rel="stylesheet" href="../../css/main.css">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60886284-1', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>

	<div class="fixed">
		<nav class="top-bar">
			<ul class="title-area">
				<li class="name"><h1><a href="../../">Noda Time</a></h1></li>
				<!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
    			<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
			</ul>

			<section class="top-bar-section">
				<!-- Right Nav Section -->
			    <ul class="right">
			      <li class="divider"></li>
			      <li class="has-dropdown">
			      	<a href="#" class="active">User Guide</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../../1.0.x/userguide">1.0.x</a></li>
			      		<li><a href="../../1.1.x/userguide">1.1.x</a></li>
			      		<li><a href="../../1.2.x/userguide">1.2.x</a></li>
			      		<li><a href="../../1.3.x/userguide">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../../unstable/userguide">Unstable</a></li>
			      	</ul>
			      </li>
                  <!-- Disable the API link for the moment...
			      <li class="divider hide-for-small"></li>
			      <li><a href="../../api" >API</a></li>
                  -->
			      <li class="divider hide-for-small"></li>
			      <li class="has-dropdown">
			      	<a href="#">API</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../../1.0.x/api">1.0.x</a></li>
			      		<li><a href="../../1.1.x/api">1.1.x</a></li>
			      		<li><a href="../../1.2.x/api">1.2.x</a></li>
			      		<li><a href="../../1.3.x/api">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../../unstable/api">Unstable</a></li>
			      	</ul>
			      </li>
			      <li class="divider"></li>
			      <li>
                                <a href="../../developer" >Developer Guide</a>
			      </li>
			      <li class="divider"></li>
			      <li><a href="../../#info">More Info</a></li>
			      <li class="divider show-for-small"></li>
			      <li class="has-form hide-for-small">
			        <a class="button" href="../../#install">Install</a>
			      </li>
			    </ul>
			</section>

		</nav>
	</div>


	<section class="body">
	



<div class="row">
	<div class="large-9 columns">
		<h1>Updating the time zone database</h1>
		<p>Noda Time comes with a version of the
<a href="http://www.iana.org/time-zones">tz database</a> (also known as the IANA Time Zone
database, or zoneinfo or Olson database), which is now hosted by IANA. This
database changes over time, as countries decide to change their time zone
rules.  As new versions of Noda Time are released, the version of tzdb will be
updated. However, you may wish to use a new version of tzdb <em>without</em> changing
which version of Noda Time you&#39;re using. This documentation tells you how to do
so.</p>

<p>Noda Time&#39;s main library doesn&#39;t read tzdb text files directly - it uses a binary form which is the output of <code>NodaTime.TzdbCompiler</code> - another
part of the Noda Time project. This saves both space (the 2013h version takes about 125K when compiled) and
time, as the binary form contains various precomputed transitions. The file also contains a mapping from Windows time zone names
to tzdb time zone IDs, primarily so that Noda Time can map the local time zone reported by <code>TimeZoneInfo</code> to a tzdb time zone,
and (from Noda Time 1.1 onwards) TZDB location data.</p>

<p>In Noda Time 1.0, the data was stored in .NET resources. This became awkward in a number of ways, not least because of
the lack of full resource support in Portable Class Libraries. In 1.1, a new file format was introduced, along with methods
to read this format from any stream. Support for the resource
format has been removed from Noda Time 2.0.</p>

<p>For more details on the exact formats, please see the <a href="http://nodatime.org/developer/tzdb-file-format.html">documentation in the developer guide</a>.</p>

<h1>Obtaining and using a &quot;NodaZoneData&quot; file</h1>

<h2>Fetching a NodaZoneData file from nodatime.org</h2>

<p>NodaZoneData files are <a href="http://nodatime.org/tzdb/">available from nodatime.org</a>
and contain compiled versions of TZDB from 2013h onwards.</p>

<p>These can be downloaded and used with any Noda
Time 1.1+ binary, so you don&#39;t need to update to the latest version
of Noda Time in order to get the latest version of TZDB, and you
don&#39;t have to build the file yourself either.</p>

<p>The URL <a href="http://nodatime.org/tzdb/latest.txt">http://nodatime.org/tzdb/latest.txt</a>
returns a plaintext response containing the URL of the latest NZD file.
This may be used for automation.</p>

<h2>Building a NodaZoneData file</h2>

<ol>
<li>Find the link to the <a href="http://www.iana.org/time-zones">latest tzdb release</a>, e.g.
http://www.iana.org/time-zones/repository/releases/tzdata2015e.tar.gz</li>
<li>Determine the Windows mapping file you want to use, or let NodaTime.TzdbCompiler do it for you
with the versions supplied with the Noda Time source in the <code>data\cldr</code> directory. If these are
out of date, you can download a new file from <a href="http://cldr.unicode.org">CLDR</a>.</li>
<li>Run NodaTime.TzdbCompiler. I&#39;d suggest leaving it in its build directory and running it like this:</li>
</ol>
<div class="highlight"><pre><code class="language-bat" data-lang="bat">path\to\NodaTime.TzdbCompiler.exe -s tzdb-url -w windows-file-or-directory -o path\to\output.nzd
</code></pre></div>
<p>The <code>-s</code> argument can be an unpacked archive directory, a local archive, or a remote archive. The <code>-w</code>
argument can be a path to a single file, or a directory containing multiple Windows Zones XML files, in which
case the most appropriate one will be selected automatically.</p>

<h2>Using a NodaZoneData file</h2>

<p>Typically you&#39;ll want to use the newly-created resource file as the default time zone provider, across your whole application.
While it&#39;s possible to have multiple time zone providers in play at a time, that&#39;s a very rare scenario. Using a resource
file is relatively straightforward:</p>

<ul>
<li>Open a stream to the file</li>
<li>Create a <a href="../api/html/T_NodaTime_TimeZones_TzdbDateTimeZoneSource.htm"><code>TzdbDateTimeZoneSource</code></a> with the stream, using the static <code>FromStream</code> method</li>
<li>Create <a href="../api/html/T_NodaTime_TimeZones_DateTimeZoneCache.htm"><code>DateTimeZoneCache</code></a> with the source</li>
<li>Use that cache (usually by way of dependency injection as an <code>IDateTimeZoneProvider</code>) wherever you need time zone information</li>
</ul>

<p>Here&#39;s some sample code for the first three steps above:</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">NodaTime</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">NodaTime.TimeZones</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">CustomTzdb</span>
<span class="p">{</span>
    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">IDateTimeZoneProvider</span> <span class="n">provider</span><span class="p">;</span>
        <span class="c1">// Or use Assembly.GetManifestResourceStream for an embedded file</span>
        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">OpenRead</span><span class="p">(</span><span class="s">&quot;tzdb-2013h.nzd&quot;</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">source</span> <span class="p">=</span> <span class="n">TzdbDateTimeZoneSource</span><span class="p">.</span><span class="n">FromStream</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>
            <span class="n">provider</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DateTimeZoneCache</span><span class="p">(</span><span class="n">source</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">provider</span><span class="p">.</span><span class="n">SourceVersionId</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The stream is fully read in the call to <code>TzdbDateTimeZoneSource.FromStream</code>, so disposing of it afterwards (as shown above) doesn&#39;t
affect the source you&#39;ve created. The stream can come from anywhere - typically it would either be a standalone file in the file
system, or an embedded resource file within one of your assemblies. You certainly <em>could</em> fetch it across a network, if you wanted.
(It is read sequentially from start to end - no seeking is required.)</p>

		<ul class="pagination">
		
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			<li class="current hide-for-small"><a href>Updating the time zone database</a></li>
			
			
		
			
			<li><a href="../../unstable/userguide/mono.html"><strong>Next</strong>: Mono support</a></li>
			
			
			
		
			
			
			
		
			
			
			
		
			
			
			
		
		
		</ul>
	</div>

	<div class="large-3 columns">
		<div class="section-container accordian">
			<section>
				<p class="title" data-section-title>Introduction</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
                            
							<li><a href="../../unstable/userguide/" >Overview</a></li>
						
                            
							<li><a href="../../unstable/userguide/rationale.html" >Why does Noda Time exist?</a></li>
						
                            
							<li><a href="../../unstable/userguide/installation.html" >Installation</a></li>
						
					</ul>
				</div>
			</section>
			<section>
				<p class="title" data-section-title>Core</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
                            
							<li><a href="../../unstable/userguide/concepts.html" >Core concepts</a></li>
						
                            
							<li><a href="../../unstable/userguide/type-choices.html" >Choosing (and converting) between types</a></li>
						
                            
							<li><a href="../../unstable/userguide/core-types.html" >Core types quick reference</a></li>
						
                            
							<li><a href="../../unstable/userguide/recipes.html" >Recipes</a></li>
						
                            
							<li><a href="../../unstable/userguide/design.html" >Design philosophy and conventions</a></li>
						
                            
							<li><a href="../../unstable/userguide/migration-to-2.html" >Migrating from 1.x to 2.0</a></li>
						
					</ul>
				</div>
			</section>
			<section>
				<p class="title" data-section-title>Text</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
                            
							<li><a href="../../unstable/userguide/text.html" >Text handling</a></li>
						
                            
							<li><a href="../../unstable/userguide/duration-patterns.html" >Patterns for Duration values</a></li>
						
                            
							<li><a href="../../unstable/userguide/offset-patterns.html" >Patterns for Offset values</a></li>
						
                            
							<li><a href="../../unstable/userguide/instant-patterns.html" >Patterns for Instant values</a></li>
						
                            
							<li><a href="../../unstable/userguide/localtime-patterns.html" >Patterns for LocalTime values</a></li>
						
                            
							<li><a href="../../unstable/userguide/localdate-patterns.html" >Patterns for LocalDate values</a></li>
						
                            
							<li><a href="../../unstable/userguide/localdatetime-patterns.html" >Patterns for LocalDateTime values</a></li>
						
                            
							<li><a href="../../unstable/userguide/offsetdatetime-patterns.html" >Patterns for OffsetDateTime values</a></li>
						
                            
							<li><a href="../../unstable/userguide/zoneddatetime-patterns.html" >Patterns for ZonedDateTime values</a></li>
						
                            
							<li><a href="../../unstable/userguide/period-patterns.html" >Patterns for Period values</a></li>
						
					</ul>
				</div>
			</section>
			<section>
				<p class="title" data-section-title>Advanced</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
                            
							<li><a href="../../unstable/userguide/arithmetic.html" >Date and time arithmetic</a></li>
						
                            
							<li><a href="../../unstable/userguide/range.html" >Range of valid values</a></li>
						
                            
							<li><a href="../../unstable/userguide/bcl-conversions.html" >BCL conversions</a></li>
						
                            
							<li><a href="../../unstable/userguide/serialization.html" >Serialization</a></li>
						
                            
							<li><a href="../../unstable/userguide/calendars.html" >Calendars</a></li>
						
                            
							<li><a href="../../unstable/userguide/threading.html" >Threading</a></li>
						
                            
							<li><a href="../../unstable/userguide/trivia.html" >Trivia</a></li>
						
					</ul>
				</div>
			</section>
			<section>
				<p class="title" data-section-title>Library</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
                            
							<li><a href="../../unstable/userguide/testing.html" >Unit testing with Noda Time</a></li>
						
                            
							<li><a href="../../unstable/userguide/tzdb.html" class="active">Updating the time zone database</a></li>
						
                            
							<li><a href="../../unstable/userguide/mono.html" >Mono support</a></li>
						
                            
							<li><a href="../../unstable/userguide/limitations.html" >Limitations of Noda Time</a></li>
						
                            
							<li><a href="../../unstable/userguide/roadmap.html" >Current roadmap</a></li>
						
                            
							<li><a href="../../unstable/userguide/versions.html" >Version history</a></li>
						
					</ul>
				</div>
			</section>
			<footer>Version  unstable  </footer>
		</div>
	</div>
</div>

	</section>

	<footer>
		<div class="row">
			<div class="small-6 columns">
                                <span>The latest version is 1.3.1, released March 6th 2015</span>
			</div>
			<div class="small-6 columns copy">
                                &copy; <a href="https://github.com/nodatime/nodatime/blob/master/AUTHORS.txt">The Noda Time Authors</a>,
                                <span class="design">Web Design by <a href="http://nathanpalmer.com">Nathan Palmer</a></span>
			</div>
		</div>
	</footer>

	<script>
	document.write('<script src=' +
	('__proto__' in {} ? '../../js/vendor/zepto' : '../../js/vendor/jquery') +
	'.js><\/script>')
	</script>

  	<script src="../../js/foundation.min.js"></script>
  	

  <script>
    $(document).foundation();
  </script>

  <!-- Nuget Button -->
  <script type="text/javascript">
  (function () {
      var nb = document.createElement('script'); nb.type = 'text/javascript'; nb.async = true;
      nb.src = 'http://s.prabir.me/nuget-button/0.2.1/nuget-button.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(nb, s);
  })();
  </script>
</body>
</html>
