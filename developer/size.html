

<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />
	<title>Sizes of core types</title>

	<!-- foundation default -->
  	<link rel="stylesheet" href="../css/foundation.css" />

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="../css/syntax.css">

    <!-- Foundicons -->
    <link rel="stylesheet" href="../css/general_enclosed_foundicons.css">

    <!-- Prettify -->
    <script src="../js/prettify/run_prettify.js"></script>

	<script src="../js/vendor/custom.modernizr.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/mobile.css">
</head>
<body>

	<div class="fixed">
		<nav class="top-bar">
			<ul class="title-area">
				<li class="name"><h1><a href="../">Noda Time</a></h1></li>
				<!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
    			<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
			</ul>

			<section class="top-bar-section">
				<!-- Right Nav Section -->
			    <ul class="right">
			      <li class="divider"></li>
			      <li class="has-dropdown">
			      	<a href="#" >User Guide</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../1.0.x/userguide">1.0.x</a></li>
			      		<li><a href="../1.1.x/userguide">1.1.x</a></li>
			      		<li><a href="../1.2.x/userguide">1.2.x</a></li>
			      		<li><a href="../1.3.x/userguide">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../unstable/userguide">Unstable</a></li>
			      	</ul>
			      </li>
                  <!-- Disable the API link for the moment...
			      <li class="divider hide-for-small"></li>
			      <li><a href="../api" >API</a></li>
                  -->
			      <li class="divider hide-for-small"></li>
			      <li class="has-dropdown">
			      	<a href="#">API</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../1.0.x/api">1.0.x</a></li>
			      		<li><a href="../1.1.x/api">1.1.x</a></li>
			      		<li><a href="../1.2.x/api">1.2.x</a></li>
			      		<li><a href="../1.3.x/api">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../unstable/api">Unstable</a></li>
			      	</ul>
			      </li>
			      <li class="divider"></li>
			      <li>
                                <a href="../developer" class="active">Developer Guide</a>
			      </li>
			      <li class="divider"></li>
			      <li><a href="../#info">More Info</a></li>
			      <li class="divider show-for-small"></li>
			      <li class="has-form hide-for-small">
			        <a class="button" href="../#install">Install</a>
			      </li>
			    </ul>
			</section>

		</nav>
	</div>


	<section class="body">
	


<div class="row">
	<div class="large-9 columns">
		<h1>Sizes of core types</h1>
		<p>Many of Noda Time&#39;s core types are value types, and their size needs to be carefully
managed when features are added or removed. The following gives an indication of what
each of the value types consists of, and any possible space savings in the future.</p>

<h1>Duration</h1>

<p><code>Duration</code> consists of:</p>

<ul>
<li><code>int days</code></li>
<li><code>long nanoOfDay</code></li>
</ul>

<p>(12 bytes)</p>

<p>The <code>days</code> field may be negative, whereas <code>nanoOfDay</code> is always non-negative. (So to represent a duration of -1ns, you&#39;d use a <code>days</code> value of -1 and a <code>nanoOfDay</code> value of <code>NodaConstants.NanosecondsPerStandardDay - 1</code>.) While this may seem odd for a duration type, it fits in well with the layout of other types, particularly <code>LocalDate</code> and <code>LocalTime</code>.</p>

<h1>Instant and LocalInstant</h1>

<p><code>Instant</code> and <code>LocalInstant</code> each simply have a <code>Duration</code> field:</p>

<ul>
<li><code>Duration duration</code></li>
</ul>

<p>(12 bytes)</p>

<h1>LocalTime</h1>

<p>A <code>LocalTime</code> only knows about the nanosecond of the day, which is represented as a <code>long</code>:</p>

<ul>
<li><code>long nanoseconds</code></li>
</ul>

<p>(8 bytes)</p>

<p>The value is always non-negative, and requires 47 bits (to represent a maximum value one less than 86,400,000,000,000).</p>

<h1>YearMonthDay</h1>

<p><code>YearMonthDay</code> is used to split a date into year, month and day in a particular calendar, which
isn&#39;t represented in the value itself. Its representation is just a single <code>int</code>:</p>

<ul>
<li><code>int value</code></li>
</ul>

<p>(4 bytes)</p>

<p>The value is split into the three parts as:</p>

<ul>
<li>Day: 6 bits</li>
<li>Month: 6 bits</li>
<li>Year: 15 bits</li>
</ul>

<p>This leaves 5 bits available for future expansion, should they be useful - while actually allowing 
for days and months of up to 64. (If we reasonably assume no day-of-month above 32 and no month 
above 16, we can save an extra 3 bits.) Each component stores the desired value minus one, i.e. a 
raw value of 0 represents 0001-01-01. This ensures that a &quot;default&quot; <code>YearMonthDay</code> (for example
in the context of <code>new LocalDate()</code>) represents a valid value.</p>

<p>With an extra 3 bits, we could <em>potentially</em> encode a calendar system ID into <code>YearMonthDay</code> as well,
so that <code>LocalDate</code> was just a wrapper around <code>YearMonthDay</code>. This would have an impact on our
ability to create arbitrary calendar systems later, however.</p>

<h1>LocalDate</h1>

<p>A <code>LocalDate</code> is a <code>YearMonthDay</code> and a calendar system reference:</p>

<ul>
<li><code>YearMonthDay yearMonthDay</code></li>
<li><code>CalendarSystem calendar</code></li>
</ul>

<p>(4 bytes + 1 reference)</p>

<h1>LocalDateTime</h1>

<p>A <code>LocalDateTime</code> is simply the combination of a <code>LocalDate</code> and a <code>LocalTime</code>:</p>

<ul>
<li><code>LocalDate date</code></li>
<li><code>LocalTime time</code></li>
</ul>

<p>(12 bytes + 1 reference)</p>

<h1>Offset</h1>

<p>An <code>Offset</code> stores the number of seconds difference
between UTC and local time. This is within inclusive bounds of +/- 18 hours.</p>

<ul>
<li><code>int seconds</code></li>
</ul>

<p>(4 bytes; 17 bits used)</p>

<h1>OffsetDateTime</h1>

<p>An <code>OffsetDateTime</code> is <em>logically</em> a <code>LocalDateTime</code> and an <code>Offset</code>, but it&#39;s stored with separate
fields, as that has shown some surprising performance benefits:</p>

<ul>
<li><code>YearMonthDay yearMonthDay</code></li>
<li><code>long nanosecondsAndOffset</code></li>
<li><code>CalendarSystem calendar</code></li>
</ul>

<p>(12 bytes + 1 reference)</p>

<p>The nanosecondsAndOffset value is split into two parts as:</p>

<ul>
<li>Nanosecond-of-day: 47 bits</li>
<li>Offset: 17 bits</li>
</ul>

<h1>ZonedDateTime</h1>

<p>A <code>ZonedDateTime</code> is an <code>OffsetDateTime</code> and a <code>DateTimeZone</code> reference:</p>

<ul>
<li><code>OffsetDateTime offsetDateTime</code></li>
<li><code>DateTimeZone zone</code></li>
</ul>

<p>(12 bytes + 2 references)</p>

	</div>

	<div class="large-3 columns">
		<div class="section-container accordian">
			<section>
				<p class="title" data-section-title>Guide</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
							<li><a href="../developer/building.html" >Building and testing</a></li>
						
							<li><a href="../developer/coding-conventions.html" >Coding conventions</a></li>
						
							<li><a href="../developer/release-process.html" >Release process</a></li>
						
							<li><a href="../developer/roadmap.html" >Current roadmap</a></li>
						
							<li><a href="../developer/tzdb-file-format.html" >Time zone database file format</a></li>
						
							<li><a href="../developer/size.html" class="active">Sizes of core types</a></li>
						
					</ul>
				</div>
			</section>
		</div>
	</div>
</div>

	</section>

	<footer>
		<div class="row">
			<div class="small-6 columns">
                                <span>The latest version is 1.3.0, released June 27th 2014</span>
			</div>
			<div class="small-6 columns copy">
                                &copy; <a href="http://noda-time.googlecode.com/hg/AUTHORS.txt">The Noda Time Authors</a>,
                                <span class="design">Web Design by <a href="http://nathanpalmer.com">Nathan Palmer</a></span>
			</div>
		</div>
	</footer>

	<script>
	document.write('<script src=' +
	('__proto__' in {} ? '../js/vendor/zepto' : '../js/vendor/jquery') +
	'.js><\/script>')
	</script>

  	<script src="../js/foundation.min.js"></script>
  	

  <!--
  <script src="js/foundation/foundation.js"></script>
  <script src="js/foundation/foundation.alerts.js"></script>
  <script src="js/foundation/foundation.clearing.js"></script>
  <script src="js/foundation/foundation.cookie.js"></script>
  <script src="js/foundation/foundation.dropdown.js"></script>
  <script src="js/foundation/foundation.forms.js"></script>
  <script src="js/foundation/foundation.joyride.js"></script>
  <script src="js/foundation/foundation.magellan.js"></script>
  <script src="js/foundation/foundation.orbit.js"></script>
  <script src="js/foundation/foundation.placeholder.js"></script>
  <script src="js/foundation/foundation.reveal.js"></script>
  <script src="js/foundation/foundation.section.js"></script>
  <script src="js/foundation/foundation.tooltips.js"></script>
  <script src="js/foundation/foundation.topbar.js"></script>
  <script src="js/foundation/foundation.interchange.js"></script>
  -->

  <script>
    $(document).foundation();
  </script>

  <!-- Nuget Button -->
  <script type="text/javascript">
  (function () {
      var nb = document.createElement('script'); nb.type = 'text/javascript'; nb.async = true;
      nb.src = 'http://s.prabir.me/nuget-button/0.2.1/nuget-button.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(nb, s);
  })();
  </script>
</body>
</html>
