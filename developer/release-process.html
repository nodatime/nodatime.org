

<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />
	<title>Release process</title>

	<!-- foundation default -->
  	<link rel="stylesheet" href="../css/foundation.css" />

    <!-- Foundicons -->
    <link rel="stylesheet" href="../css/general_enclosed_foundicons.css">

	<script src="../js/vendor/custom.modernizr.js"></script>

    <link rel="stylesheet" href="../css/main.css">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60886284-1', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>

	<div class="fixed">
		<nav class="top-bar">
			<ul class="title-area">
				<li class="name"><h1><a href="../">Noda Time</a></h1></li>
				<!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
    			<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
			</ul>

			<section class="top-bar-section">
				<!-- Right Nav Section -->
			    <ul class="right">
			      <li class="divider"></li>
			      <li class="has-dropdown">
			      	<a href="#" >User Guide</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../1.0.x/userguide">1.0.x</a></li>
			      		<li><a href="../1.1.x/userguide">1.1.x</a></li>
			      		<li><a href="../1.2.x/userguide">1.2.x</a></li>
			      		<li><a href="../1.3.x/userguide">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../unstable/userguide">Unstable</a></li>
			      	</ul>
			      </li>
                  <!-- Disable the API link for the moment...
			      <li class="divider hide-for-small"></li>
			      <li><a href="../api" >API</a></li>
                  -->
			      <li class="divider hide-for-small"></li>
			      <li class="has-dropdown">
			      	<a href="#">API</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../1.0.x/api">1.0.x</a></li>
			      		<li><a href="../1.1.x/api">1.1.x</a></li>
			      		<li><a href="../1.2.x/api">1.2.x</a></li>
			      		<li><a href="../1.3.x/api">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../unstable/api">Unstable</a></li>
			      	</ul>
			      </li>
			      <li class="divider"></li>
			      <li>
                                <a href="../developer" class="active">Developer Guide</a>
			      </li>
			      <li class="divider"></li>
			      <li><a href="../#info">More Info</a></li>
			      <li class="divider show-for-small"></li>
			      <li class="has-form hide-for-small">
			        <a class="button" href="../#install">Install</a>
			      </li>
			    </ul>
			</section>

		</nav>
	</div>


	<section class="body">
	


<div class="row">
	<div class="large-9 columns">
		<h1>Release process</h1>
		<p>This document describes how Noda Time is released. It is intended to be used as
a checklist by the person doing a release.</p>

<h2>Prerequisites</h2>

<ul>
<li>Visual Studio 2015</li>
<li>Sandcastle and Sandcastle Help File Builder</li>
<li><a href="http://jekyllrb.com/docs/installation/">Jekyll</a> and <a href="http://rubygems.org/gems/redcarpet">redcarpet</a> (following the Jekyll Windows installation instructions)</li>
<li>NuGet command-line tool</li>
<li>Access to the Noda Time release private key (to produce a strong-named
assembly) and the nuget.org API key</li>
<li>Access to the (git) repository for the nodatime.org web site</li>
</ul>

<p>Note that we should not build releases on Mono at present, since the resulting
IL triggers a bug in the .NET 4 64-bit CLR (see the
<a href="building.html">building and testing</a> section in the developer guide).</p>

<h2>When to release</h2>

<p>When everybody&#39;s happy, there are no issues outstanding for the milestone, and
all the tests pass.</p>

<p>Search the issue tracker for open issues with the right milestone (e.g.
<code>is:open is:issue milestone:1.4.0</code>).</p>

<p>Update to the candidate revision (probably HEAD) of the correct branch (e.g.
<code>1.0.x</code>) and <a href="building.html">build and run all the tests</a> as normal. The build
and test steps should pass on Visual Studio 2015 and at least one supported
OS/version combination for Mono (i.e. &#39;Mono 2.10.9 on Linux&#39;).</p>

<h2>Update the embedded tzdb</h2>

<p>If necessary, update the version of tzdb on the branch to the latest current
version, following the instructions in the
<a href="../userguide/tzdb.html">&quot;Updating the time zone database&quot;</a> section in the user guide.</p>

<h2>Pre-release branching</h2>

<p>Before building the first release with a given minor version number (i.e. 1.0.0,
1.1.0, or more typically, a -beta or -rc version of the same), we&#39;ll need to
branch. New user-visible functionality is introduced with a new minor version
number (per the <a href="http://semver.org">Semantic versioning</a> spec).</p>

<p>The branching model used by Noda Time is the Subversion-style backport model.
In brief:</p>

<ul>
<li>feature development is carried out on the master branch</li>
<li>named branches (called &#39;1.0.x&#39;, &#39;1.1.x&#39;, etc) are used for release lines</li>
<li>fixes are typically backported to the earlier branches where necessary
(typically using <code>git cherry-pick</code>).</li>
</ul>

<p>Note the difference between the format of names used for tags (&#39;1.0.0-beta2&#39;,
&#39;1.0.0&#39;) and those used for branches (&#39;1.0.x&#39;). Git will allow both to be
used as &quot;tree-ish&quot; values, so it is important that they do not collide.</p>

<h3>Branch-specific changes</h3>

<p>The only change that needs to be made to the branch after creation is to
remove the <code>&lt;Preliminary/&gt;</code> tag from the Sandcastle project file; see e.g.
<a href="https://github.com/nodatime/nodatime/issues/102">issue 102</a>.</p>

<h3>Post-branch updates on the master branch</h3>

<p>If this release required the creation of a new branch, then the following files
on the <code>master</code> branch should be updated to bump (at least) the minor version
number (and <code>NodaTime.Testing</code> / <code>NodaTime.Serialization.JsonNet</code> dependency
version), per the following scheme:</p>

<p>Suppose we were building version 1.2.3-beta4, then:</p>

<blockquote>
<ul>
<li>In the NuGet package specs, <code>&lt;version&gt;</code> should contain the version number
(&#39;1.2.3-beta4&#39;). The <code>&lt;dependency&gt;</code> element in <code>NodaTime.Testing.nuspec</code>
should reference the <em>initial release</em> for the major/minor version
(i.e. &#39;1.2.0&#39;) for stable versions, or the full version for
pre-release versions.</li>
<li>In the AssemblyInfo files, <code>AssemblyVersion</code> should be set to just the
major/minor version (&#39;1.2&#39;). <code>AssemblyFileVersion</code> should be set to the
major, minor, and patch version (&#39;1.2.3&#39;), and <code>AssemblyInformationalVersion</code>
should be set to the version number (&#39;1.2.3-beta4&#39;). (See <a href="http://stackoverflow.com/a/65062">this Stack
Overflow post</a> for more information about how these are
used.)</li>
</ul>
</blockquote>

<p>Update the version number by building the tools solution and then running the <code>SetVersion</code> tool:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat">msbuild build\Tools.sln
build\SetVersion\bin\Debug\SetVersion.exe <span class="m">1</span>.<span class="m">1</span>.<span class="m">0</span>-dev
</code></pre></div>
<p>The version number string should be of the form <code>1.1.0-dev</code>.</p>

<h2>Making the release</h2>

<p>Switch to the correct branch (e.g. <code>1.0.x</code>).</p>

<p>Update the version number according to the scheme above by building the tools
solution and then running the <code>SetVersion</code> tool:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat">msbuild tools\Tools.sln
build\SetVersion\bin\Debug\SetVersion.exe <span class="m">1</span>.<span class="m">2</span>.<span class="m">3</span>-beta<span class="m">4</span>
</code></pre></div>
<blockquote>
<p>This will update the following AssemblyInfo files and NuGet package specs to include the
version number you are building:</p>

<ul>
<li><code>src/NodaTime/Properties/AssemblyInfo.cs</code></li>
<li><code>src/NodaTime.Serialization.JsonNet/Properties/AssemblyInfo.cs</code></li>
<li><code>src/NodaTime.Testing/Properties/AssemblyInfo.cs</code></li>
<li><code>src/NodaTime/NodaTime.nuspec</code></li>
<li><code>src/NodaTime.Serialization.JsonNet/NodaTime.Serialization.JsonNet.nuspec</code></li>
<li><code>src/NodaTime.Testing/NodaTime.Testing.nuspec</code></li>
</ul>
</blockquote>

<p>Add the current date and TZDB version to the version history in
<code>www/unstable/userguide/versions.md</code> and regenerate all documentation.
(The branch version of the <code>www/</code> directory is only used for the offline
user guide; we leave the documentation in <code>unstable/</code> for branches.)</p>

<p>Commit the above, then tag that commit:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat">git tag <span class="m">1</span>.<span class="m">0</span>.<span class="m">0</span>-beta<span class="m">1</span>
</code></pre></div>
<p>(If the tag has already been applied, use <code>-f</code> to force it.)</p>

<p>Switch back to the master branch and update the version history in that branch
to match the changes applied to the release branch, then (if this release
changes the latest stable release), update the date and version number of the
latest stable version in <code>www/_config.yml</code>, and (if that new stable release is
not a patch release), also update the <code>/api</code> and <code>/userguide</code> redirects in
<code>src/NodaTime.Web/web.config</code>.</p>

<p>Push these changes to GitHub, ensuring that you push the tags as well as any changes.
(Use <code>--tags</code> from the command line.)</p>

<h2>Building the release artifacts</h2>

<p>First, <em>create a new clone for building the release</em>. Doing this avoids the
need to worry about ignored files and local changes making their way into
the archives.</p>

<p>Copy the Noda Time private key into the top-level directory.</p>

<p>Use the <code>build\buildrelease.bat</code> batch file to build all the release artifacts:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat"><span class="k">cd</span> build
buildrelease <span class="m">1</span>.<span class="m">0</span>.<span class="m">0</span>-beta<span class="m">1</span>
</code></pre></div>
<p>This will create:</p>

<ul>
<li>A zip file of pristine sources (e.g. <code>NodaTime-1.0.0-beta1-src.zip</code>)</li>
<li>A zip file for binary distribution (e.g. <code>NodaTime-1.0.0-beta1.zip</code>)</li>
<li>NuGet packages (in the <code>nuget</code> directory)</li>
</ul>

<p>(See <code>buildrelease.bat</code> for details.)</p>

<h2>Publishing the artifacts</h2>

<p>Upload the source and release zipfiles to the project website, under
the <code>downloads</code> directory. To do this, pull the
<a href="https://github.com/nodatime/nodatime.org"><code>nodatime.org</code> repository</a>,
update the <code>downloads</code> directory accordingly, commit and then push back
up to GitHub. The web site will update automatically.</p>

<p>Edit the <code>downloads/index.html</code> file to include the new downloads,
including SHA-256 hash.</p>

<p>If this is a stable release, update the version number and the links on the
front page to point to the new downloads.</p>

<p>Upload the three NuGet packages to nuget.org:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat">nuget push NodaTime.<span class="m">1</span>.<span class="m">0</span>.<span class="m">0</span>-beta<span class="m">1</span>.nupkg
nuget push NodaTime.Testing.<span class="m">1</span>.<span class="m">0</span>.<span class="m">0</span>-beta<span class="m">1</span>.nupkg
nuget push NodaTime.Serialization.JsonNet.<span class="m">1</span>.<span class="m">0</span>.<span class="m">0</span>-beta<span class="m">1</span>.nupkg
</code></pre></div>
<h2>Updating the generated API documentation</h2>

<p>Copy the generated API documentation from <code>docs/api</code> to the corresponding
<code>/$BRANCH/api</code> directory in the <code>nodatime.org</code> repository.</p>

<h2>Announcing the release</h2>

<p>Post to the mailing list, blog, etc.</p>

<h2>Post-release updates on the master branch</h2>

<p>If this release was a stable release, then the generated XML documentation
should be copied to <code>data/versionxml/</code> on the master branch.</p>

<p>If this release required the creation of a new branch, then the following
updates need to be made to the master branch for the website:</p>

<ul>
<li>the user guide source in <code>www/unstable/userguide</code> should be copied to
<code>www/$BRANCH/userguide</code> (except for <code>versions.md</code>, which should come from the
branch copy)</li>
<li>the Jekyll/Liquid templates (<code>www/_layouts/foundation.html</code>) should be
adjusted to add the new branch for the &quot;API&quot; and &quot;User Guide&quot; dropdowns</li>
</ul>

	</div>

	<div class="large-3 columns">
		<div class="section-container accordian">
			<section>
				<p class="title" data-section-title>Guide</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
							<li><a href="../developer/building.html" >Building and testing</a></li>
						
							<li><a href="../developer/coding-conventions.html" >Coding conventions</a></li>
						
							<li><a href="../developer/release-process.html" class="active">Release process</a></li>
						
							<li><a href="../developer/roadmap.html" >Current roadmap</a></li>
						
							<li><a href="../developer/tzdb-file-format.html" >Time zone database file format</a></li>
						
							<li><a href="../developer/size.html" >Sizes of core types</a></li>
						
					</ul>
				</div>
			</section>
		</div>
	</div>
</div>

	</section>

	<footer>
		<div class="row">
			<div class="small-6 columns">
                                <span>The latest version is 1.3.1, released March 6th 2015</span>
			</div>
			<div class="small-6 columns copy">
                                &copy; <a href="https://github.com/nodatime/nodatime/blob/master/AUTHORS.txt">The Noda Time Authors</a>,
                                <span class="design">Web Design by <a href="http://nathanpalmer.com">Nathan Palmer</a></span>
			</div>
		</div>
	</footer>

	<script>
	document.write('<script src=' +
	('__proto__' in {} ? '../js/vendor/zepto' : '../js/vendor/jquery') +
	'.js><\/script>')
	</script>

  	<script src="../js/foundation.min.js"></script>
  	

  <script>
    $(document).foundation();
  </script>

  <!-- Nuget Button -->
  <script type="text/javascript">
  (function () {
      var nb = document.createElement('script'); nb.type = 'text/javascript'; nb.async = true;
      nb.src = 'http://s.prabir.me/nuget-button/0.2.1/nuget-button.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(nb, s);
  })();
  </script>
</body>
</html>
