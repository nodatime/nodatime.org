

<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />
	<title>Building and testing</title>

	<!-- foundation default -->
  	<link rel="stylesheet" href="../css/foundation.css" />

    <!-- Foundicons -->
    <link rel="stylesheet" href="../css/general_enclosed_foundicons.css">

	<script src="../js/vendor/custom.modernizr.js"></script>

    <link rel="stylesheet" href="../css/main.css">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-60886284-1', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body>

	<div class="fixed">
		<nav class="top-bar">
			<ul class="title-area">
				<li class="name"><h1><a href="../">Noda Time</a></h1></li>
				<!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone -->
    			<li class="toggle-topbar menu-icon"><a href="#"><span>Menu</span></a></li>
			</ul>

			<section class="top-bar-section">
				<!-- Right Nav Section -->
			    <ul class="right">
			      <li class="divider"></li>
			      <li class="has-dropdown">
			      	<a href="#" >User Guide</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../1.0.x/userguide">1.0.x</a></li>
			      		<li><a href="../1.1.x/userguide">1.1.x</a></li>
			      		<li><a href="../1.2.x/userguide">1.2.x</a></li>
			      		<li><a href="../1.3.x/userguide">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../unstable/userguide">Unstable</a></li>
			      	</ul>
			      </li>
                  <!-- Disable the API link for the moment...
			      <li class="divider hide-for-small"></li>
			      <li><a href="../api" >API</a></li>
                  -->
			      <li class="divider hide-for-small"></li>
			      <li class="has-dropdown">
			      	<a href="#">API</a>
			      	<ul class="dropdown">
			      		<li><label>Versions</label></li>
			      		<li><a href="../1.0.x/api">1.0.x</a></li>
			      		<li><a href="../1.1.x/api">1.1.x</a></li>
			      		<li><a href="../1.2.x/api">1.2.x</a></li>
			      		<li><a href="../1.3.x/api">1.3.x</a></li>
			      		<li class="divider hide-for-small"></li>
			      		<li><a href="../unstable/api">Unstable</a></li>
			      	</ul>
			      </li>
			      <li class="divider"></li>
			      <li>
                                <a href="../developer" class="active">Developer Guide</a>
			      </li>
			      <li class="divider"></li>
			      <li><a href="../#info">More Info</a></li>
			      <li class="divider show-for-small"></li>
			      <li class="has-form hide-for-small">
			        <a class="button" href="../#install">Install</a>
			      </li>
			    </ul>
			</section>

		</nav>
	</div>


	<section class="body">
	


<div class="row">
	<div class="large-9 columns">
		<h1>Building and testing</h1>
		<h2>Visual Studio (Windows)</h2>

<p>TODO: As of 2.0, the following is no longer correct: <em>building</em> Noda Time
2.0 requires a C# 6 compiler.</p>

<p>Noda Time is mostly developed on Visual Studio 2010 and Visual Studio 2012.
All versions of Visual Studio 2010 and 2012 which support C#, including Express editions,
should be able to build Noda Time. If you&#39;re using Visual Studio Express, you <em>may</em> have
problems building the PCL version; it depends on other aspects of your computer. Visual
Studio Express itself doesn&#39;t have full support for portable class libraries, so while
it&#39;s important to us that developers with only Visual Studio Express can work on the
desktop build, we make no guarantees about the PCL build.
(Please contact the mailing list if you have problems not covered here.) </p>

<p>You&#39;ll also need the <a href="http://msdn.microsoft.com/en-us/netframework/aa569263.aspx">.NET Framework SDK</a>. This library supports
versions 3.5, 4 and 4.5 of the Framework. Install the appropriate
version or versions as defined by your needs.</p>

<p>To fetch the source code from the main GitHub repository, you&#39;ll need a
<a href="http://git-scm.com/">git</a> client. A good alternative for Microsoft Windows users is
<a href="https://tortoisegit.org/">TortoiseGit</a> which installs shell extensions so that git can be used
from the Windows Explorer.</p>

<p>To run the tests, you&#39;ll need <a href="http://nunit.org/index.php?p=download">NUnit</a> version 2.5.10 or higher.</p>

<p>Unfortunately though we target .NET 3.5 for <em>running</em> Noda Time on the desktop, the unit test
library targets .NET 4. This is mostly so that we can easily run the tests against the PCL
build. We would like to run the desktop build tests against .NET 3.5 and the PCL build tests
against .NET 4, but that sort of subtlety seems to cause problems with the ability of
test runners to autodetect which version they should load. We don&#39;t use any .NET 4 features
in our tests though; if you hack at the project file to make it only target .NET 3.5, you should
be able to test the desktop build that way, if you really need to.</p>

<h3>Fetching and building</h3>

<p>To fetch the source code, just clone the GitHub repository:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat"><span class="p">&gt;</span> <span class="n">git</span> clone https:<span class="n">//github.com/nodatime/nodatime.git</span>
</code></pre></div>
<p>To build everything under Visual Studio, simply open the <code>src\NodaTime-All.sln</code> file.
To build with just the SDK and msbuild, run</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat"><span class="p">&gt;</span> <span class="n">msbuild</span> src\NodaTime-All.sln <span class="n">/property:Configuration=Debug</span>
</code></pre></div>
<p>Execute the tests using your favourite NUnit test runner. For example:</p>
<div class="highlight"><pre><code class="language-bat" data-lang="bat"><span class="p">&gt;</span> <span class="n">nunit</span>-console src\NodaTime.Test\bin\Debug\NodaTime.Test.dll
</code></pre></div>
<p>(Include the other test DLLs should you wish to, of course.)</p>

<h2>Mono</h2>

<p><em>Building</em> Noda Time 2.0 requires a C# 6 compiler.</p>

<p>As of March 2015, no released version of Mono supports C# 6, though
built-from-source versions of what will become Mono 4.0.0 do.</p>

<p>While not intended to be a complete guide to installing Mono from source, on
Linux, you probably want to do something approximately like the following:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>sudo apt-get install autoconf automake libtool-bin  <span class="c"># etc</span>

<span class="nv">$ PREFIX</span><span class="o">=</span><span class="nv">$HOME</span>/mono/4.0.0  <span class="c"># or wherever</span>
<span class="nv">$ </span>git clone git@github.com:mono/mono.git mono-git
<span class="nv">$ </span><span class="nb">cd </span>mono-git/
<span class="nv">$ </span>git checkout mono-4.0.0-branch
<span class="nv">$ </span>git submodule init
<span class="nv">$ </span>git submodule update
<span class="nv">$ </span>./autogen.sh --prefix<span class="o">=</span><span class="nv">$PREFIX</span>
<span class="nv">$ </span>make get-monolite-latest
<span class="nv">$ </span>make <span class="nv">EXTERNAL_MCS</span><span class="o">=</span><span class="k">${</span><span class="nv">PWD</span><span class="k">}</span>/mcs/class/lib/monolite/basic.exe
<span class="nv">$ </span>make install
<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PREFIX</span>/bin:<span class="nv">$PATH</span>
<span class="nv">$ </span>mono --version <span class="p">|</span> head -n1
Mono JIT compiler version 4.0.0 <span class="o">(</span>mono-4.0.0-branch/b7bcd23 Tue <span class="m">24</span> Mar 16:03:12 GMT 2015<span class="o">)</span>
<span class="nv">$ </span>mozroots --import --sync  <span class="c"># otherwise NuGet will fail with SSL errors later</span>
Mozilla Roots Importer - version 4.0.0.0
Download and import trusted root certificates from Mozilla<span class="s1">&#39;s MXR.</span>
<span class="s1">Copyright 2002, 2003 Motus Technologies. Copyright 2004-2008 Novell. BSD</span>
<span class="s1">licensed.</span>

<span class="s1">Downloading from</span>
<span class="s1">&#39;</span>http://mxr.mozilla.org/seamonkey/source/security/nss/lib/ckfw/builtins/certdata.txt?raw<span class="o">=</span>1<span class="err">&#39;</span>...
Importing certificates into user store...
<span class="m">140</span> new root certificates were added to your trust store.
Import process completed.
</code></pre></div>
<p>(More generally, see the <a href="http://www.mono-project.com/docs/compiling-mono/linux/#building-mono-from-a-git-source-code-checkout" title="Compiling Mono on Linux: Building Mono From a Git Source Code Checkout">Mono documentation</a> for more details
about building from source on Linux.)</p>

<h3>Noda Time 1.x</h3>

<p>We have tested Mono support using Mono 2.10.5 and 2.10.8.</p>

<p>To build Noda Time under Linux, you typically need to install the following
packages:</p>

<ul>
<li>mono-devel</li>
<li>mono-xbuild</li>
</ul>

<p>(These will add the other dependencies you need.)</p>

<p>Note that for Ubuntu specifically, you&#39;ll either need Ubuntu 11.10 (Oneiric) or
later, or work out how to install an unofficial backport; earlier versions of
Ubuntu <a href="http://www.mono-project.com/DistroPackages/Ubuntu">do not include a suitable version of Mono</a>.</p>

<p>To build Noda Time under OS X, <a href="http://www.mono-project.com/Download">download</a> the latest stable
release of Mono. Be sure to choose the developer package, not the smaller
runtime-only package.  To use the provided <code>Makefile</code>, you&#39;ll either need to
install <a href="https://developer.apple.com/xcode/">Xcode</a> or obtain <code>make</code> separately (for example, using
<a href="https://github.com/kennethreitz/osx-gcc-installer#readme">osx-gcc-installer</a> to install just the open-source parts of Xcode).</p>

<h3>Fetching the source</h3>

<p>To fetch the source code from the main GitHub repository, you&#39;ll need a
<a href="http://git-scm.com/">git</a> client.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>git clone https://github.com/nodatime/nodatime.git
<span class="nv">$ </span><span class="nb">cd </span>nodatime
</code></pre></div>
<p>Building is performed with <code>make</code>, using the included Makefile. (If you don&#39;t
have a working <code>make</code>, you can also run <code>xbuild</code> by hand; see <code>Makefile</code> for
the commands you&#39;ll need to run.)</p>

<h3>Fetching dependencies</h3>

<p>Building Noda Time requires a small number of third-party packages.  These
can be most easily obtained via <a href="https://www.nuget.org/">NuGet</a>.</p>

<p>To fetch NuGet.exe locally, download and run (using <code>mono</code>) the
(auto-updating) <a href="http://nuget.codeplex.com/releases/view/58939">NuGet.exe command-line
tool</a>.</p>

<p>You can then fetch the NuGet packages locally (into <code>src/packages/</code>):</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>make fetch-packages <span class="nv">NUGET</span><span class="o">=</span>/path/to/NuGet.exe
</code></pre></div>
<p>(<code>NUGET=</code> can be omitted if NuGet.exe is in the current directory.)</p>

<h3>Building</h3>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>make
</code></pre></div>
<p>This will build all the Noda Time main projects. The main assembly will be
written to <code>src/NodaTime/bin/Debug/NodaTime.dll</code>; this is all you need to use
Noda Time itself.</p>

<p>Other build targets are also available; again, see <code>Makefile</code> for documentation.</p>

<h3>Testing</h3>

<p>To run the tests, you&#39;ll need <a href="http://nunit.org/index.php?p=download">NUnit</a> version 2.5.10 or higher. (The
version that comes with Mono doesn&#39;t support everything used by the unit
tests of Noda Time.) Version 2.6.1 or higher is recommended on non-Windows
platforms due to an <a href="https://bugs.launchpad.net/nunitv2/+bug/993247" title="NUnit Bug #993247: Tests fail with IOException: Too many open files">NUnit bug</a> that causes tests to fail with
a &quot;Too many open files&quot; exception when running some of the larger suites.</p>

<p>To build and run the tests, run:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>make check
</code></pre></div>
<p>to use the default (from <code>PATH</code>) version of NUnit, or something like the
following to override the location of the NUnit test runner:</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nv">$ </span>make check <span class="nv">NUNIT</span><span class="o">=</span><span class="s1">&#39;mono ../NUnit-2.6.1/bin/nunit-console.exe&#39;</span>
</code></pre></div>
<h2>Source layout</h2>

<p>All the source code is under the <code>src</code> directory. There are multiple projects:</p>

<ul>
<li>NodaTime: The main library to be distributed</li>
<li>NodaTime.Benchmarks: Benchmarks run regularly to check the performance</li>
<li>NodaTime.CheckTimeZones: Tool to verify that Joda Time and Noda Time interpret TZDB data in the same way</li>
<li>NodaTime.Demo: Demonstration code written as unit tests. Interesting <a href="http://stackoverflow.com">Stack Overflow</a> questions can lead to code in this project, for example.</li>
<li>NodaTime.Serialization.JsonNet: Library to enable <a href="http://json.net">Json.NET</a> serialization of NodaTime types.</li>
<li>NodaTime.Serialization.Test: Tests for all serialization assemblies, under the assumption that at some point we&#39;ll support more than just Json.NET.</li>
<li>NodaTime.Test: Tests for the main library</li>
<li>NodaTime.Testing: Library to help users test code which depends on Noda Time. Also used within our own tests.</li>
<li>NodaTime.Tools.SetVersion: Tool to set version numbers on appropriate assemblies as part of the release process</li>
<li>NodaTime.TzdbCompiler: Tool to take a TZDB database and convert it into the NodaTime internal format</li>
<li>NodaTime.TzdbCompiler.Test: Tests for NodaTime.TzdbCompiler</li>
</ul>

<p>The documentation is in the <code>www</code> directory with the rest of the website: <code>www/developer</code> for the developer guide, and <code>www/unstable/userguide</code> for the latest user guide.
Additionally the <code>www</code> directory contains the source for the documentation, and <code>JodaDump</code> contains Java code to be used with NodaTime.CheckTimeZones.</p>

<p>There are four solutions, containing a variety of projects depending on the task at hand. The aim is to have everything you immediately need in one
place, without too many distractions.</p>

<ul>
<li>NodaTime-All.sln: Contains all .NET projects, but not the documentation source. Useful for continuous integration and refactoring.</li>
<li>NodaTime-Core.sln: Contains NodaTime, NodaTime.Benchmarks, NodaTime.Serialization.JsonNet and NodaTime.Serialization.Test, NodaTime.Test, NodaTime.Testing.
This is the &quot;day to day development&quot; solution, containing everything that&#39;s shipped and the primary tests for those projects. When we&#39;re updating NodaTime.TzdbCompiler,
that project and its tests may temporarily live in this solution.</li>
<li>NodaTime-Documentation.sln: Contains the documentation sources, NodaTime, NodaTime.Testing.SerializationJsonNet and NodaTime.Testing. Useful when writing documentation.</li>
<li>NodaTime-Tools.sln: Contains NodaTime (so that project references work), NodaTime.CheckTimeZones, NodaTime.Tools.SetVersion, NodaTime.TzdbCompiler
and NodaTime.TzdbCompiler.Test. Aimed at times when we need to change our supporting toolset.</li>
</ul>

	</div>

	<div class="large-3 columns">
		<div class="section-container accordian">
			<section>
				<p class="title" data-section-title>Guide</p>
				<div class="content" data-section-content>
					<ul class="side-nav">
						
							<li><a href="../developer/building.html" class="active">Building and testing</a></li>
						
							<li><a href="../developer/coding-conventions.html" >Coding conventions</a></li>
						
							<li><a href="../developer/release-process.html" >Release process</a></li>
						
							<li><a href="../developer/roadmap.html" >Current roadmap</a></li>
						
							<li><a href="../developer/tzdb-file-format.html" >Time zone database file format</a></li>
						
							<li><a href="../developer/size.html" >Sizes of core types</a></li>
						
					</ul>
				</div>
			</section>
		</div>
	</div>
</div>

	</section>

	<footer>
		<div class="row">
			<div class="small-6 columns">
                                <span>The latest version is 1.3.1, released March 6th 2015</span>
			</div>
			<div class="small-6 columns copy">
                                &copy; <a href="https://github.com/nodatime/nodatime/blob/master/AUTHORS.txt">The Noda Time Authors</a>,
                                <span class="design">Web Design by <a href="http://nathanpalmer.com">Nathan Palmer</a></span>
			</div>
		</div>
	</footer>

	<script>
	document.write('<script src=' +
	('__proto__' in {} ? '../js/vendor/zepto' : '../js/vendor/jquery') +
	'.js><\/script>')
	</script>

  	<script src="../js/foundation.min.js"></script>
  	

  <script>
    $(document).foundation();
  </script>

  <!-- Nuget Button -->
  <script type="text/javascript">
  (function () {
      var nb = document.createElement('script'); nb.type = 'text/javascript'; nb.async = true;
      nb.src = 'http://s.prabir.me/nuget-button/0.2.1/nuget-button.min.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(nb, s);
  })();
  </script>
</body>
</html>
